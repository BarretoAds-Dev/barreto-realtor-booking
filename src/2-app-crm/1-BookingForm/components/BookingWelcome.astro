---
import type { EasyBrokerProperty } from '@/1-app-global-core/types/easybroker';
import BookingPublic from '@/2-app-crm/1-BookingForm/BookingPublicForm/BookingPublic';

interface Props {
	availableSlots: Array<{
		date: string;
		dayOfWeek: string;
		slots: Array<{
			time: string;
			available: boolean;
			capacity: number;
			booked: number;
		}>;
		metadata?: {
			notes?: string;
			specialHours?: boolean;
		};
	}>;
	config: {
		slotDuration: number;
		bufferTime: number;
		businessHours: Record<string, any>;
	};
	property?: EasyBrokerProperty | null;
	initialOperationType?: 'rentar' | 'comprar';
	allowedOperationType?: 'rentar' | 'comprar' | null; // Mantener para compatibilidad
}

const { availableSlots, config, property, initialOperationType, allowedOperationType } = Astro.props;
---

<!-- Este componente ahora solo renderiza el formulario, el header y la tarjeta del inmueble se renderizan en la página principal -->
<BookingPublic
	availableSlots={availableSlots}
	config={config}
	isModal={false}
	showConfirmation={true}
	useCRMForm={false}
	preselectedProperty={property ? {
		id: property.public_id,
		title: property.title,
		address: typeof property.location === 'string' ? property.location : property.location?.address || '',
		price: property.operations?.[0]?.amount || 0,
		property_type: property.property_type,
		operations: property.operations,
		image: property.title_image_full || property.title_image_thumb || property.images?.[0]?.url || undefined,
	} : null}
	initialOperationType={initialOperationType}
	allowedOperationType={allowedOperationType || (initialOperationType ? initialOperationType : null)}
	client:visible
/>

<style>
	/* Estilos para los select dropdowns */
	select {
		background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%239ca3af' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3e%3c/svg%3e");
		background-position: right 0.75rem center;
		background-repeat: no-repeat;
		background-size: 1.5em 1.5em;
		padding-right: 2.5rem;
	}

	select:focus {
		background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%23111827' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3e%3c/svg%3e");
	}

	/* Estilos para los radio buttons personalizados */
	input[type="radio"]:checked + div > div {
		border-color: #111827;
		background-color: #111827;
	}

	input[type="radio"]:checked + div > div > div {
		background-color: white;
	}

	/* Animación suave para mostrar/ocultar campos */
	.animate-fadeIn {
		animation: fadeIn 0.3s ease-in-out;
	}

	@keyframes fadeIn {
		from {
			opacity: 0;
			transform: translateY(-10px);
		}
		to {
			opacity: 1;
			transform: translateY(0);
		}
	}

	.animate-fadeIn {
		animation: fadeIn 0.4s ease-out;
	}

	.line-clamp-2 {
		display: -webkit-box;
		-webkit-line-clamp: 2;
		-webkit-box-orient: vertical;
		overflow: hidden;
	}
</style>

