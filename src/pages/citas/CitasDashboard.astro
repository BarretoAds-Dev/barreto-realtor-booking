---
import BookingWelcome from '@/2-app-crm/1-BookingForm/components/BookingWelcome.astro';
import Layout from '@/layouts/Layout.astro';

// ðŸ”§ ConfiguraciÃ³n por defecto (puede venir de Supabase en el futuro)
const config = {
	slotDuration: 45,
	bufferTime: 5,
	businessHours: {}
};

// ðŸš€ Cargar disponibilidad desde API de Supabase
let filteredSlots: any[] = [];
const supabaseUrl = import.meta.env.PUBLIC_SUPABASE_URL;

if (supabaseUrl) {
	try {
		const startDate = new Date().toISOString().split('T')[0];
		const endDate = new Date();
		endDate.setMonth(endDate.getMonth() + 6);
		const endDateStr = endDate.toISOString().split('T')[0];

		const baseUrl = import.meta.env.SITE || 'http://localhost:4321';
		const response = await fetch(`${baseUrl}/api/appointments/available?start=${startDate}&end=${endDateStr}`);

		if (response.ok) {
			filteredSlots = await response.json();
		} else {
			console.warn('API de disponibilidad no disponible');
		}
	} catch (error) {
		console.warn('Error al cargar desde API:', error);
	}
}
---

<Layout>
	<BookingWelcome
		availableSlots={filteredSlots}
		config={config}
		client:visible
	/>
</Layout>
